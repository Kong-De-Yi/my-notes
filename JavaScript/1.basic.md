# 简介

- 在 Javascript 引擎(如 Chrome 中的 V8)中执行的纯文本形式的“脚本”
- 语言规范 ECMAScript
- 能做什么取决于运行环境(浏览器环境中削弱，Node.js 中权限全面)

## 浏览器环境能做什么

- 操作 HTML 和 CSS
- 响应用户行为
- 与服务器交换数据
- 本地存储数据

## 浏览器环境不能做什么

- 不能直接访问操作系统功能
- 同源策略，只能与当前页面所在的服务器通信

## 浏览器环境中代码位置

- 内嵌 HTML 中：

```html
<script>
  alert("Hello,world!");
</script>
```

- 外部脚本导入到 HTML 中：

```html
<script src="/path/to/script.js"></script>
```

# 代码结构

## 语句（分号分隔）：

- 代码块后不需要加分号

```javascript
alert("Hello");
alert("World");

function f() {
  //函数声明后不需要加分号
}

for (;;) {
  //循环语句后不需要加分号
}
```

## 注释

```javascript
alert("Hello"); //单行注释
/*这是一个多行
注释*/
alert("Hello");
alert("World");
```

- 现代模式"use strict"，放置在代码最顶部

# 变量

## 变量的定义（声明）：let

```javascript
let mesage;
let message = "Hello";
let user = "John",
  age = 25,
  messge = "Hello";
```

- 严格模式下先定义再使用
- 减少变量的重用
- 不要重复定义

## 变量的命名：

- 字母、数字、$、\_
- 首字母非数字
- 驼峰式命名：myVeryLongName
- 区分大小写
- 不要用保留字

# 常量

## 常量的定义：const

- 常规命名(执行前未知)：

```javascript
const myBirthday = "1987.02.23";
```

- 大写命名(执行前已知，硬编码)：

```javascript
const COLOR_RED = "#F00";
const COLOR_GREEN = "#0F0";
let color = COLOR_RED;
```

# 数据类型

- 7 种原始类型，1 种引用类型
- 动态数据类型：同一个变量存放的数据类型可以变化

## Number：整数和浮点数

```javascript
let n = 123;
n = 12.345;
alert(Infinity);
alert(NaN + 1);
```

- 支持运算+、-、\*、/
- 特殊数值
  - $ \pm $ Infinity(无穷大 ∞，1/0)
  - NaN(计算错误，粘性传播，例外 NaN\*\*0=1)
- 范围 ±($2^{53}$-1)

## BigInt：任意长度的整数

```javascript
//尾部的"n"表示BigInt类型
const bigInt = 12345n;
```

## String：字符串

```javascript
let str = "Hello"; //let str='Hello';单双引号都可以
let guestList = "Guest:\n * John\n * Pete\n * Mary"; //使用转义字符

//反引号(用 ${} 嵌入变量和表达式)
let phrase = `can embed another ${str}`;
let result = `result is ${a + b}`;

//反引号支持跨行
let guestList = `Guests:
* John
* Pete
* Mary
`;
alert(guestList); //多行形式显示

//反引号可使用"模板函数"
let num = 10;
let str = func`Hello World${num}`; //func被自动调用，接受字符串和嵌入的表达式
```

## Boolean：逻辑类型

```javascript
//只有true和false两个值
let nameFieldChecked = true;
let ageFieldChecked = false;
let isGreater = 4 > 1;
```

## null：值未知

```javascript
let age = null;
//不同于空指针，仅表示未知的特殊值
```

## undefined：声明的变量未赋值

```javascript
let age;
alert(age); //结果是undefined
```

## Symbol：对象的唯一标识符

## Object：存储数据集合和复杂实体

## typeof 运算符：字符串形式返回参数的数据类型

```javascript
typeof undefined; //返回"undefined"
typeof 0; //返回"number"
typeof 10n; //返回"bigint"
typeof true; //返回"boolean"
typeof "foo"; //返回“string"
typeof Symbol("id"); //返回”symbol"
typeof Math; //返回"object"
typeof null; //返回"object"(语言遗留错误)
typeof alert; //返回"function"(实际是object)
```

- typeof 是运算符，不是函数
- 另一种习惯写法：typeof(x)

# 用户交互

## 通知模态窗：alert()

```javascript
alert("Hello");
```

## 输入模态窗：prompt()

- title:窗口显示文本
- default:输入默认值
- 返回用户输入值或者 null

```javascript
let result=null;
result=prompt(title,[default]);
```

## 确认模态窗：confirm()

- question:窗口显示文本
- 返回 true 或者 false

```javascript
let result = null;
result = confirm(question);
```

# 类型转换

## 自动转换：运算符和函数会进行自动转换

## 显式转换

### 字符串转换：String()

```javascript
let value = true;
value = String(value); //"true"
```

### 数字型转换：Number()

```javascript
let str = "123";
let num = Number(str); //123
```

- 非有效数字 -> NaN
- undefined -> NaN
- null -> 0
- true / false -> 1 / 0
- "" -> 0
- string -> number 或者 NaN
  - 去掉首尾空白字符（空格、换行符 \n、制表符 \t 等）后的纯数字字符串中含有的数字。如果剩余字符串为空，则转换结果为 0。否则，将会从剩余字符串中“读取”数字。当类型转换出现 error 时返回 NaN

### 布尔型转换：Boolean()

- 0、空字符串、null、undefined、NaN->false
- 其他->true

# 运算符

##　运算元：运算符应用的对象

- 一元运算符
- 二元运算符
- 同一个符号可以表征不同的运算符，如减号-，取决于运算元的个数和类型
- 所有的运算符都有返回值

## 数学运算

- 加+、减-、乘\*、除/、取余%、求幂\*\*(含非整数幂)
- 除+，其他运算符都会自动将 string 转 number

```javascript
let result = 6 - "2"; //4
let result = "6" / "2"; //3
```

## 字符串连接：+（二元）

```javascript
let s = "my" + "string"; //"mystring"
```

- 注意：只要任意一个运算元是 string，另一个运算元也自动转换成 string

```javascript
let str = "1" + 2; //"12"
let str = 2 + 2 + "1"; //"41"
let str = "1" + 2 + 2; //"122"
```

## 数字转换：+（一元）

- 将非 number 转成 number，等效于 Number()

```javascript
let result=+true;  //1
let result=+"";  //0
let apples='2';
let oranges='3';
let total=+apples++oranges;  //5，等效于let total=Number(apples)+Number(oranges)
```

## 运算符优先级：

- （）拥有最高优先级
- 一元高于二元
- [运算符优先级汇总表](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Operator_precedence#%E6%B1%87%E6%80%BB%E8%A1%A8)

## 赋值运算符：=

- 优先级为 2

- 有返回值

```javascript
let a = 1;
let b = 2;
let c = 3 - (a = b + 1); //0

let a, b, c;
a = b = c = 2 + 2; //链式赋值
```

## 增强赋值运算符：+=、-=、\*=、/= ...

- 优先级为 2

```javascript
let n = 2;
n = n + 5;
n = n * 2;

let n = 2;
n += 5; //缩写写法
n *= 2; //缩写写法
```

## 自增、自减：++、--（前置、后置）

```javascript
let counter = 2;
counter++; //返回原值后再+1
counter--; //返回原值后再-1
++counter; //+1后再返回
--counter; //-1后再返回
```

## 位运算符：在 32 位整数的二进制形式上操作

## 逗号运算符：,（返回最后一个表达式的值）

```javascript
for(a=1,b=3,c=a*b;a<10;a++){...}
```

## 比较运算符：结果为 boolean

### ==（宽松相等）

- 不同类型比较：尽可能转换为数字比较
- 特殊情况：

  - undefined == null -> true
  - undefined 和 null 与任何值比较，不转换为数字，始终返回 false
  - 对象与非对象比较：对象调用 valueOf() / toString()转为原始值再比较
  - NaN 与任何值（包括自己）比较 -> false
  - Boolean 与其他类型比较：转数字后再比较（true -> 1,false ->0）
  - String 与 Number 比较：转数字后再比较
  - Symbol 与其他类型比较：不自动转换，始终返回 false(Symbol() == Symbol()也是 false)

### ===（严格相等）

- 类型不同 —> 直接 false
- 类型相同：
  - Number：数值相同（NaN != NaN）
  - String：内容相同
  - Boolean：同为 true 或 false
  - Object：引用同一对象
  - Symbol：引用同一 Symbol
  - null === null,undefined === undefined

### <,>,<=,>=（不等比较）

- 两边都是字符串 -> 按 unicode 码点逐位比较
- 其他情况 -> 转换为数字比较
- 特殊情况：
  - Symbol 不能进行不等比较（TypeError）
  - 对象比较：转为原始值（优先 valueOf()，再 toString())

```javascript
null === undefined; //false
null == undefined; //true
NaN === NaN; //false,NaN与任何值都不等，包括自己
NaN == NaN; //false
+0 === -0; //true
```

## 逻辑运算符

- 运算元可以为任意类型（自动转为 boolean)，结果也可以是任意类型

### 逻辑或：||（寻找第一个真值)

- 语法：`result = value1 || value2 || value3;`

- 从左至右计算操作数并转为 boolean，遇到 true 就**停止计算**并返回操作数的**初始值**,没有遇到就返回最后一个操作数（始终返回操作数的初始形式）

```javascript
alert(1 || 0); //1
alert(null || 1); //1
alert(null || 0 || 1); //1
alert(undefined || null || 0); //false
```

- 常见用法：

1. 获取变量列表或表达式中的第一个真值

```javascript
let firstName = "";
let lastName = "";
let nickName = "SuperCoder";
alert(firstName || lastName || nickName || "Anonymous"); //SuperCoder
```

2. 短路求值

```javascript
true || alert("not printed"); //不会运行alert
false || alert("printed"); //运行alert
```

### 逻辑与：&&（寻找第一个假值)

- 语法：`result = value1 && value2 && value3;`

- 从左至右计算操作数并转为 boolean，遇到 false 就**停止计算**并返回操作数的**初始值**,没有遇到就返回最后一个操作数（始终返回操作数的初始形式）

```javascript
alert(1 && 0); //0
alert(1 && 5); //5
alert(null & 5); //null
alert(0 && "no matter what"); //0
alert(1 && 2 && null && 3); //null
```

### 逻辑非：！

- 语法：`result = !value;`

- 将操作数转为 boolean，并返回相反的值

```javascript
alert(!true); //false
alert(!0); //true
alert(!!"non-empty string"); //true
alert(!!null); //false
```

- !!将值转为 boolean，等同于`Boolean()`

* **优先级：！> && > ||**

```javascript
(a && b) || (c && d); //等效于 ( a && b ) || ( c && d )
```

### 空值合并运算符：??

- 语法：`result = a ?? b;`

- 如果 a 不为 null/undefined，返回 a,否则返回 b
- 常见用法：
  - 提供默认值
  - 从一系列值中选出第一个非 null/undefined 的值
  - 与 || 的区别，|| 无法返回第一个参数中的(false、0、空字符串)
  - 与 || 相同的优先级（3），需要加括号
  - 禁止与&&、||一起使用，除非用括号

```javascript
let user;
alert(user ?? "匿名"); //匿名
user = "John";
alert(user ?? "匿名"); //John

let firstName = null;
let lastName = null;
let nickName = "Supercoder";
//显示第一个已定义的值
alert(firstName ?? lastName ?? nickName ?? "匿名"); //Supercoder

let height = 0;
alert(height || 100); //返回100
alert(height ?? 100); //返回0

let height = null;
let width = null;
let area = (height ?? 100) * (width ?? 50);//需要括号

let x=1 && 2 ?? 3;//语法错误
let x=(1 && 2) ?? 3;//正常工作
```

# 条件分支：if 和'?'

## "if"语句

- 计算括号内的表达式并将结果转换成 boolean，为 true 则执行对应代码块
- 多个条件"else if"
- "else"语句：可选

```javascript
let year = prompt(
  "In which year was ECMAScript-2015 specification published?",
  ""
);
if (year < 2015) {
  alert("Too early...");
} else if (year > 2015) {
  alert("Too late");
} else {
  alert("Exactly!");
}
```

## 条件运算符"?"(三元运算符)

- 语法：`let result = condition ? value1 : value2;`

- 逻辑：计算 condition,结果为 true 返回 value1,否则返回 value2

### 多个"?"

```javascript
let age=prompt("age?",18);
let message=(age < 3) ? "Hi baby!" : (age < 18) ? "Hello":( age < 100 )?:"Greetings!":"What an unusual age!";
alert(message);

//非常规写法
let company=prompt("Which company created Javascript?","");
company=="Netscape" ? alert("Right") : alert("Wrong");
```

## "switch"语句

- 替代多个 if 判断
- 至少一个 case,default 可选
- switch/case 参数可以是任何表达式

```javascript
switch(x){
  case 'value1'://if(x==='value1')
    ...
    [break]
  case 'value2'://if(x==='value2')
    ...
    [break]
  default:
    ...
    [break]
}
```

- 执行逻辑：从上往下检查 x 与 case 后的值是否**严格相等**，相等则执行 case 下的代码块，遇到 break 则结束整个 switch，没有相等的 case，则执行 default 下的代码块
- 如果没有 break,程序将**不经过任何检查**继续执行下一个 case（只执行一次严格相等检查，并具有穿透性）

```javascript
//程序连续执行
//alert("Exactly!");
//alert("Too big");
//alert("I don't know such values");
let a = 2 + 2;
switch (a) {
  case 3:
    alert("Too small");
  case 4:
    alert("Exactly!");
  case 5:
    alert("Too big");
  default:
    alert("I don't know such values");
}

//"case"分组
let a = 3;
switch (a) {
  case 4:
    alert("Right!");
    break;
  //下面这两个case被分在一组
  case 3:
  case 5:
    alert("Wrong!");
    alert("Why don't you take a math class?");
    break;
  default:
    alert("The result is strange.Really.");
}

//类型很关键
let arg = prompt("Enter a value?");
switch (arg) {
  case "0":
  case "1":
    alert("One or zero");
    break;
  case "2":
    alert("Two");
    break;
  //"3" !== 3,case 3不会执行
  case 3:
    alert("Never executes!");
    break;
  default:
    alert("An unknown value");
}
```

# 循环：while 和 for

## "while" 循环

- 语法：

```javascript
while (condition) {
  //循环体代码
}
```

- condition 可为任何表达式或变量
- 逻辑：计算 condition，将结果转换为 boolean， 为 true 时,执行循环体 code

## "do...while"循环

- 语法：

```javascript
do {
  //循环体代码
} while (condtion);
```

- 循环体至少执行一次

## "for"循环

- 语法：

```javascript
for (begin; condition; step) {
  //body（循环体）
}
```

- begin：进入循环前执行一次，可为内联变量（可以省略）
- condition：每次循环迭代之前检查，为 false 则停止循环（可以省略）
- body:condition 为 true 时，重复执行
- stp：每次循环迭代之后执行（可以省略）

```javascript
//i为内联变量，只在循环中可见
for (let i = 0; i < 3; i++) {
  alert(i);
}
alert(i); //错误，变量未声明

//使用现有变量
let i = null;
for (i = 0; i < 3; i++) {
  alert(i);
}

for (;;) {
  //无限循环
}
```

## "break"结束整个循环

- 在循环体中间进行条件检查

```javascript
let sum = 0;
while (true) {
  let value = +prompt("Enter a number", "");
  //输入内容不是数字时结束循环
  if (!value) break;
  sum += value;
}
alert(`Sum:${sum}`);
```

## "continue"结束当前循环

- 停止当前这一次迭代，启动新一轮循环
- 有利于减少循环体中的嵌套

```javascript
for (let i = 0; i < 10; i++) {
  //条件为真，跳过当前循环剩余部分，立即进入下一轮迭代
  if (i % 2 == 0) continue;
  alert(i);
}
```

- 三元运算符"?"右边禁止出现 break/continue

```javascript
i > 5 ? alert(i) : continue;//语法错误
```

## break/continue 标签

- 跳出多层嵌套循环

```javascript
labelName: for (;;) {
  for (;;) {
    break labelName; //向上寻找labelName标签，并结束整个标签循环
    continue labelName; //向上寻找labelName标签，并跳转到标签循环的下一次迭代
  }
}
```

- 标签必须在 break/continue 语句上方
- break 必须在代码块内
- continue 必须在循环代码块内

```javascript
label: {
  break label; //有效
}
```

# 函数

## 函数的定义（声明）与调用：

```javascript
//函数的定义
function name(parameter1,parameter2,...,parameterN){
  //函数体code
}

//函数的调用
name(parameter1,parameter2,...,parameterN);
```

- 使用函数的好处：
  - 避免代码重复
  - 逻辑有更改，只需要改一处代码

## 局部变量

- 函数体内声明的变量只在函数体内可见

```javascript
function showMessage() {
  let message = "Hello,I'm JavaScript"; //局部变量
  alert(message);
}
showMessage(); //Hello,I'm JavaScript
alert(message); //变量未声明
```

## 外部变量（全局变量）

- 函数可以访问外部变量
- 会被同名局部变量遮蔽

```javascript
let userName = "John";
function showMessage() {
  userName = "Bob"; //修改外部变量
  let message = "hello," + userName; //读取外部变量
  alert(message);
}
alert(userName); //John
showMessage();
alert(userName); //Bob,被函数修改了

let userName = "John";
function showMessage() {
  let userName = "Bob"; //声明了同名局部变量
  let message = "Hello," + userName; //Bob
  alert(message);
}
showMessage(); //使用局部变量userName
alert(userName); //John,外部变量未被更改
```

## 参数

- 用**复制**方式向函数体中传递局部变量
- 函数定义时可以指定默认值,默认值可以是任意表达式

```javascript
function showMessage(from, text) {
  from = "*" + from + "*";
  alert(from + ":" + text);
}
let from = "Ann";
showMessage(from, "Hello"); //*Ann*:Hello
alert(from); //Ann,外部变量未改变，函数修改的是副本

function showMessage(from,text="no text given"){
  alert(from+":"+text)；
}
showMessage("Ann");//Ann:no text given

function showMessage(from,text=anotherFunction()){
  //anotherFunction仅在text没传递值时调用，返回值将成为text的值
}
```

## 返回值

- return：返回表达式的值，并退出函数（不写返回值默认返回 undefined）
- 没有 return 的函数返回 undefined

```javascript
function checkAge(age) {
  if (age > 18) {
    return true;
  } else {
    return confirm("Got a permission from the parents?");
  }
}

function showMovie(age) {
  if (!check(age)) {
    return; //退出函数
  }
  alert("Showing you the movie");
}
```

## 函数命名

- 动词前缀，常用 getXXX、calcXXX、createXXX、checkXXX
- 函数只做和函数名指定的事，自描述

## 函数表达式

- 函数的本质：一种特殊的值

```javascript
//下面两个函数等效：创建一个函数，并存储在变量sayHi中
function sayHi() {
  alert("Hello");
}
let sayHi = function () {
  //可以省略函数名
  alert("Hello");
};
alert(sayHi); //显示函数代码
let func = sayHi; //复制到其他变量
func(); //Hello
```

## 回调函数

- 函数作为参数传递
- 可创建匿名函数，外部无法访问

```javascript
function ask(question, yes, no) {
  if (confirm(question)) yes();
  else no();
}
function showOk() {
  alert("You agreed.");
}
function showCancel() {
  alert("You canceled the execution.");
}

ask("Do you agree?", showOk, showCancel);
//也可以用匿名函数
ask(
  "Do you agree?",
  function () {
    alert("You agreed.");
  },
  function () {
    alert("You canceled the execution.");
  }
);
```

## 函数表达式 VS 函数声明（创建时机不同）

- 函数表达式：在代码执行到达时被创建，并且仅从那一刻起可用
- 函数声明：在函数声明被定义之前，它就可以被调用（javascript 引擎会提前创建全局函数）
- 函数声明具有块级作用域

```javascript
let age = 16;
if (age < 18) {
  welcome(); //Hello!
  function welcome() {
    alert("Hello!");
  }
  welcome(); //Hello!
} else {
  function welcome() {
    alert("Greetings!");
  }
}
welcome(); //错误：函数未声明

//使用函数表达式
let age = prompt("What is your age?", 18);
let welcome;
if (age < 18) {
  welcome = function () {
    alert("Hello!");
  };
} else {
  welcome = function () {
    alert("Greetings!");
  };
}
welcome(); //正常执行
```

## 箭头函数

- 单行语法：`let func=(arg1,arg2,...,argN) => expression;`

```javascript
//等效版本
let func=function(arg1,arg2,...,argN){
  return expression;
}
```

- 1 个参数可省略括号：`let double = n => n * 2;`
- 0 个参数需保留括号：`let sayHi = () => alert("Hello");`
- 动态创建函数:

```javascript
let age = prompt("What is your age?", 18);
let welcome = age < 18 ? () => alert("Hello") : () => alert("Greetings!");
welcome();
```

- 多行语法：使用花括号，用 return 显式返回

```javascript
let sum = (a, b) => {
  let result = a + b;
  return result;
};
alert(sum(1, 2)); //3
```
